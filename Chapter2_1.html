<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" /> 
        <style>
        p.ex1 
        {
        margin-left: 30%;
        margin-right: 30%;
        }
        h4.ex1
        {
        margin-left: 30%;
        margin-right: 30%;
        }
        blockquote.ex1
        {
        margin-left: 35%;
        margin-right: 35%;
        }
        ul.ex1 
        {
        margin-left: 30%;
        margin-right: 20%;
        }
        div.ex1 
        {
        margin-left: 30%;
        margin-right: 30%;
        }
        div.ex2 
        {
        margin-left: 20%;
        margin-right: 20%;
        }
</style>
 <style type="text/css">
 p.topright
 {
   position:absolute;
   top:0;
   right:135px;
  }
  p.topleft
 {
   position:absolute;
   top:0;
   left:135px;
  }
   p.bottomright
 {
   position:fixed;
   bottom:0;
   right:135px;
  }
</style>
        <title>Mahler as Editor</title>
        <!-- verovio scripts -->
        <script src="https://www.verovio.org/javascript/develop/verovio-toolkit.js" type="text/javascript" ></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript" ></script>
        <script src="javascript/basic-events.js" type="text/javascript" ></script>

        <!-- scripts necessary for the MIDI player -->
        <script type="text/javascript" language="javascript" src="javascript/midi-player/wildwebmidi.js"></script>
        <script type="text/javascript" language="javascript" src="javascript/midi-player/midiplayer.js"></script>
        <link rel="stylesheet" href="css/midiplayer.css" />

        <!-- help overlay stylesheet -->
        <link rel="stylesheet" href="css/help_overlay.css" />
    </head>
    <body>
        <h4 class="ex1">Part II: Mahler’s Revisions</h4>
        <p class="topright"><a href="Chapter2_2.html" target="_self">Next Page ---></a></p>
        <p class="topleft"><a href="index.xhtml" target="_self">&lt;--- Previous Page</a></p>
        <p class="ex1">
            <u>Methodology, Overview</u>
        </p>
        <p class="ex1" style="text-indent: 3em">
            This section explores Mahler’s specific revisions to <i>Der Bärenhäuter</i> in depth. The first section examines the 
            large-scale architectural alterations (mostly cuts), while the second focuses on localized, minute changes (both cuts 
            and additions). My survey of the <i>Bärenhäuter</i> cuts began with the vocal scores and the conductor’s scores (one 
            volume per act).<a id="t19" href="#fn19"><sup>19</sup></a> 
            I compared the edits found there to a sampling of orchestral parts, where I paid particular attention to the first four 
            desks of first violins, the first desk of second violins, the first desk of cellos, and the first bassoon. The cuts 
            marked in the scores do not always match up with the parts. Either there was some uncertainty about exactly where the 
            cuts would be, or Mahler changed his mind at some point between his score study and the orchestra’s rehearsals. In cases
            of discrepancy, I have generally given priority to the parts, as this is more likely to reflect what was actually 
            performed in the event. Several have timings written in, though their accuracy is open to debate since the total 
            duration (two hours and fifty-seven minutes, according to one player) exceeds that of the more modern recording by over
            half an hour.<a id="t20" href="#fn20"><sup>20</sup></a> Regardless, the parts provide insight into the revision history.
            For example, the orchestra must have rehearsed the overture, as it is marked as lasting twelve minutes, though it was 
            not included in the production in the end. By examining these materials, I aim to show how editing was a creative 
            process for Mahler and reflective of his dramaturgical sense.  As a starting point, it is useful to assess the overall 
            scope of Mahler’s cuts, as they are extensive.             
        </p>
        <p class="ex1">
            <u>Table I: Mahler's cuts to <i>Der Bärenhäuter</i></u>
        </p>
        <ul class="ex1">
            <li>Act I
                <ul>
                    <li>Overture
                        <ul>
                            <li>Cut in its entirety (340 measures)</li>
                        </ul>
                    </li>
                    <li>
                        Scene 1
                        <ul>
                            <li>
                                (I.1.1): 13 after rehearsal 1 to 9 before rehearsal 3 (9 measures)
                            </li>
                            <li>
                                (I.1.2): 4 after rehearsal 5 to 4 after rehearsal 6 (9 measures)
                            </li>
                            <li>
                                (I.1.3): 4 before rehearsal 11 to 2 before rehearsal 12 (8 measures)
                            </li>
                            <li>
                                (I.1.4): 4 before rehearsal 22 to 5 after rehearsal 22 (8 measures)
                            </li>
                        </ul>
                        <li>
                            Scene 2
                            <ul>
                                <li>
                                    (I.2.1): 3 before rehearsal 26 to 4 before rehearsal 27 (14 measures)
                                </li>
                                <li>
                                    (I.2.2): 4 after rehearsal 28 to 2 before rehearsal 29 (8 measures)
                                </li>
                                <li>
                                    (I.2.3): 6 after rehearsal 31 to 3 after rehearsal 33 (39 measures)
                                </li>
                            </ul>
                        </li>
                        <li>
                            Scene 3
                            <ul>
                                <li>
                                    (I.3.1): 3 before rehearsal 50 to 1 before rehearsal 51 (8 measures)
                                </li>
                                <li>
                                    (I.3.2): 4 after rehearsal 56 to 2 before rehearsal 58 (11 measures)
                                </li>
                                <li>
                                    (I.3.3): 4 before rehearsal 66 to 7 after rehearsal 71 (61 measures)
                                </li>
                            </ul>
                        </li>
                        <li>
                            Scene 4
                            <ul>
                                <li>
                                    (I.4.1): 14 after rehearsal 72 to 3 before rehearsal 73 (4 measures)
                                </li>
                                <li>
                                    (I.4.2): 4 before rehearsal 75 to 5 before rehearsal 77 (24 measures)
                                </li>
                                <li>
                                    (I.4.3): 5 before rehearsal 79 to 5 before rehearsal 80 (10 measures)
                                </li>
                                <li>
                                    (I.4.4): 4 before rehearsal 91 to rehearsal 92 (17 measures)
                                </li>
                                <li>
                                    (I.4.5): 1 after rehearsal 95 to 3 before rehearsal 97 (18 measures)
                                </li>
                                <li>
                                    (I.4.6): 3 after rehearsal 114 to 4 after rehearsal 117 (33 measures)
                                </li>
                                <li>
                                    (I.4.7): 10 after rehearsal 120 to 3 before rehearsal 121 (3 measures)
                                </li>
                                <li>
                                    (I.4.8): 3 before rehearsal 123 to 3 after rehearsal 123 (5 measures)
                                </li>
                                <li>
                                    (I.4.9): 5 before rehearsal 126 to 1 before rehearsal 127 (16 measures)
                                </li>
                                <li>
                                    (I.4.10): 3 before rehearsal 130 to 4 before rehearsal 133 (23 measures)
                                </li>
                            </ul>
                        </li>

                    </li>
                </ul>
            </li>
            <li>
                Act II
                <ul>
                    <li>
                        Scene 1
                        <ul>
                            <li>
                                (II.1.1): Rehearsal 12 to 9 after rehearsal 14 (31 measures)
                            </li>
                            <li>
                                (II.1.2): 7 before rehearsal 15 to 3 after rehearsal 20 (62 measures)
                            </li>
                            <li>
                                (II.1.3): 7 after rehearsal 24 to rehearsal 26 (14 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 2
                        <ul>
                            <li>
                                (II.2.1): 4 before rehearsal 35 to 12 after rehearsal 35 (15 measures)
                            </li>
                            <li>
                                (II.2.2): 8 before rehearsal 36 to 1 before rehearsal 36 (7 measures)
                            </li>
                            <li>
                                (II.2.3): 9 before rehearsal 41 to 1 before rehearsal 42 (22 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 3
                        <ul>
                            <li>
                                (II.3.1): 8 after rehearsal 42 to rehearsal 44 (22 measures)
                            </li>
                            <li>
                                (II.3.2): 5 after rehearsal 44 to 1 before rehearsal 45 (11 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 4
                        <ul>
                            <li>
                                Entire scene (96 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 6
                        <ul>
                            <li>
                                (II.6.1): 2 before rehearsal 96 to 9 before rehearsal 97 (11 measures)
                            </li>
                            <li>
                                (II.6.2): 8 after rehearsal 99 to 6 after rehearsal 103 (57 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 7
                        <ul>
                            <li>
                                Entire scene (204 measures)
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                Act III
                <ul>
                    <li>
                        Vorspiel
                        <ul>
                            <li>
                                (III.1.1): Rehearsal 1 to 3 before rehearsal 4 (31 measures)
                            </li>
                            <li>
                                (III.1.2): 9 before rehearsal 6 to 12 after rehearsal 7 (38 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 1
                        <ul>
                            <li>
                                (III.1.3): 4 after rehearsal 8 to 2 before rehearsal 11 (23 measures)
                            </li>
                            <li>
                                (III.1.4): Rehearsal 12 to 1 after rehearsal 13 (13 measures)
                            </li>
                            <li>
                                (III.1.5): 3 before rehearsal 15 to 9 after rehearsal 16 (20 measures)
                            </li>
                            <li>
                                (III.1.6): 12 after rehearsal 26 to 12 before rehearsal 30 (37 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 3
                        <ul>
                            <li>
                                (III.3.1): 4 after rehearsal 48 to 4 after rehearsal 49 (12 measures)
                            </li>
                            <li>
                                (III.3.2): 4 before rehearsal 50 to 4 before rehearsal 51 (23 measures)
                            </li>
                            <li>
                                (III.3.3): Rehearsal 52 to 8 before rehearsal 55 (30 measures)
                            </li>
                            <li>
                                (III.3.4): 9 after rehearsal 67 to 3 before rehearsal 69 (23 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 4
                        <ul>
                            <li>
                                (III.4.1): Rehearsal 72 to 4 before rehearsal 75 (33 measures)
                            </li>
                            <li>
                                (III.4.2): 6 after rehearsal 78 to rehearsal 81 (34 measures)
                            </li>
                            <li>
                                (III.4.3): 4 before rehearsal 84 to 6 after rehearsal 86 (39 measures)
                            </li>
                            <li>
                                (III.4.4): 7 after rehearsal 96 to 3 before rehearsal 99 (27 measures)
                            </li>
                            <li>
                                (III.4.5): Rehearsal 101 to rehearsal 103 (14 measures)
                            </li>
                            <li>
                                (III.4.6): Rehearsal 104 to rehearsal 109 (56 measures)
                            </li>
                        </ul>
                    </li>
                    <li>
                        Scene 5
                        <ul>
                            <li>
                                (III.5.1): 4 after rehearsal 113 to rehearsal 116 (24 measures)
                            </li>
                            <li>
                                (III.5.2): 1 after rehearsal 117 to 4 after rehearsal 118 (13 measures)
                            </li>
                            <li>
                                (III.5.3): Rehearsal 119 to 7 after rehearsal 119 (6 measures)
                            </li>
                            <li>
                                (III.5.4): Rehearsal 120 to 10 after rehearsal 120 (9 measures)
                            </li>
                            <li>
                                (III.5.5): Rehearsal 121 to rehearsal 124 (28 measures)
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        <br/>
        <p class="ex1" style="text-indent: 3em">
            These are the cuts alone; I have not included Mahler’s additive revisions in the present list, but they do not come 
            close to matching the scope of the cuts. This is in line with Mahler’s known process for editing and revising his own 
            symphonies, which he pruned during rehearsals and after performances but rarely (if ever) expanded. The majority of 
            Mahler’s cuts in operatic works are marked with “vi-de” notation, where “vi” indicates the beginning of the cut material
            and “de” is written at the end of the cut, a standard operatic procedure. This is illustrated below. 
        </p>
    <br/>
        <div class="ex2" style="width: 750px; height: 500px;">
                <img class="ex1" src="https://github.com/MrMeatScience/Mahler-as-Editor/blob/master/Images/Score%20Pic%20(1:2%20combine).jpg?raw=true" alt="Vi-De cut sample" height="100%" width="100%"/>
        </div>
        <p class="ex1">
            <u>Image I: “Vi-De” indicating a cut, ÖNB MS full scores, OA.1328.</u>
        </p>
        <br/>
        <p class="ex1" style="text-indent: 3em">
            The excised portions of <i>Der Bärenhäuter</i> are no exception, but some individual cases arise where different 
            indications for cuts are used for no readily apparent reason. This manner of indicating a cut instead uses several 
            diagonal hatch marks to cross through the score, and a parallel pair in the margins indicating that the cut is over. 
            An example of this style is also provided below.
        </p>
            <br/>
        <div class="ex1" style="width: 378px; height: 504px;">
            <img class="ex1" src="https://github.com/MrMeatScience/Mahler-as-Editor/blob/master/Images/Score%20Pic%203.jpeg?raw=true" alt="Mahler's hatchmarks" height="100%" width="100%"/>
        </div>
        <p class="ex1">
            <u>Image II: Mahler’s hatch-marks, ÖNB MS full scores, OA.1328</u>
        </p>
        <br/>
        <p class="ex1" style="text-indent: 3em">
            That these cuts are Mahler’s is confirmed by their appearance in his hand in other edited operatic scores, such as 
            Weber’s <i>Euyranthe</i>, where they sometimes appear in conjunction with the vi/de system.<a id="t21" href="#fn21"><sup>21</sup></a> 
            Though de la Grange asserts that all of Mahler’s cuts in <i>Bärenhäuter</i> were for dramaturgical purposes, this overlooks 
            the excision of the overture (possibly missed by de la Grange, since it is not marked as cut in the scores, but only 
            the parts).<a id="t22" href="#fn22"><sup>22</sup></a> This must have been a change made out of musical concerns, albeit
            one made late in the rehearsal process, as previously noted.
        </p>
        <p class="ex1">
            <u>Structural Changes: Act II</u>
        </p>
        <p class="ex1" style="text-indent: 3em">
            The cuts that were substantial enough to affect the opera’s structure occur in the second act. Though not the most 
            offensive to Mahler’s sensibilities — that distinction is reserved for the third act, which he told Siegfried was 
            “rubbish” — it contains two scenes Mahler cut in their entirety, the fourth and seventh.<a id="t23" href="#fn23"><sup>23</sup></a> 
            The fourth scene deals principally with the innkeeper, Nikolas Spitz, who decides to investigate Hans’ bottomless bag 
            of gold with the intent of stealing it. Upon opening it, various unpleasant animals and spirits are released, such as 
            bats, flying frogs, giant mosquitos, scorpions, and “alles erdenkliche Ungeziefer,” frightening the innkeeper.
        </p>
        <p class="ex1" style="text-indent: 3em">
            It is not likely that Mahler cut scene 4 simply to keep the duration of the opera on the slim side, as this scene in a 
            modern recording only lasts a bit over two minutes. It is, however, difficult to sing, even harder to stage 
            convincingly, and of little narrative consequence. After the animals are released in the first half of the scene, 
            Hans enters the room to find a thoroughly unsettled Spitz and confronts him about the attempted theft, which the 
            innkeeper readily admits to without hesitation, and Hans drags him out of the room and closes the door. The music is 
            atmospheric but of little substance. The cut produces a certain dramaturgical tautness, devoid of “filler,” although 
            this is not Mahler’s guiding principle throughout.  He actually added dialogue earlier in the opera, when Hans pays off 
            the mayor’s debts to the innkeeper (Act II, scene 3), to clarify a point in the plot.<a id="t24" href="#fn24"><sup>24</sup></a> 
            This revision makes it very explicit that Spitz has seen Hans agree to pay on the mayor’s behalf, and would help the 
            audience follow the plot when he goes to steal the bag. In Mahler’s revision, Act II scene 3 transitions directly into 
            scene 5, and the sack of gold is left unmolested, suggesting that the innkeeper’s added dialogue was intended to remind
            the audience about Hans’ bottomless moneybag. 
        </p>
        <br/>
        <p class="ex1">
            <u>FIGURE I: Act 2 Scene 2 added dialogue</u>
        </p>
        <!-- The div where we are going to insert the MIDI Player -->
        <div style="height: 30px; width:max-content;margin-left: 30%">
            <div id="player" style="position: absolute;width:450px; display: none;"></div>
        </div><br/>

        


        <!-- The div where we are going to insert the SVG -->
        <div id="svg_output"></div>

        <!-- A help overlay -->
        <div id="help_overlay">
            <p>Press <b>'+'</b> or <b>'-'</b> to zoom in or out</p><br/>
            <p>Press <b>right</b> or <b>left</b> arrows to navigate the score</p><br/>
            <p>Press <b>ctrl + right</b> / <b>left</b> arrows to go to the beginning or the end</p><br/>
            <p>Press <b>1</b> to show and highlight the published score</p><br/>
            <p>Press <b>2</b> to show and highlight Mahler's revisions</p><br/>
            <p>Press <b>p</b> to start and stop playback</p><br/>
        </div>
        <br/>
        <br/>
        <hr/>
        <p class="ex1" id="fn19">
            <a href="#t19"><sup>19</sup></a> ÖNB MS (vocal score, OA.2544) and ÖNB MS (full scores, OA.1328).
        </p>
        <p class="ex1" id="fn20">
            <a href="#t20"><sup>20</sup></a> Siegfried Wagner. <i>Der Bärenhäuter</i> (<i>The Man in a Bear’s Skin</i>). Thüringian Symphony Orchestra. Konrad Bach. Marco Polo 8.223713-14, 1994, 2 CDs.
        </p>
        <p class="ex1" id="fn21">
            <a href="#t21"><sup>21</sup></a> John Wilson, “Mahler as operatic director: an exploration of some little-known Viennese sources”, in <i>Beethoven 7 Studien und Interpretationen</i>, ed. Magdalena Chrenkoff (Krakow: Akademia Muzyczna, 2018), 153-167.
        </p>
        <p class="ex1" id="fn22">
            <a href="#t22"><sup>22</sup></a> La Grange, <i>Mahler: The Years of Challenge (1897-1904)</i>, 158.
        </p>
        <p class="ex1" id="fn23">
            <a href="#t23"><sup>23</sup></a> Ibid., 157.
        </p>
        <p class="ex1" id="fn24">
            <a href="#t24"><sup>24</sup></a> Handwritten changes in ÖNB MS full scores, OA.1328, 57.
        </p>
        <p class="bottomright">
            <a href="Chapter2_2.html">Next Page --></a>
        </p>
        <script 
            type="text/javascript">
            var vrvToolkit = new verovio.toolkit();

            // navigation variables
            var page = 1;
            var zoom = 40;
            var pageHeight = 2970;
            var pageWidth = 2100;

            // for keeping track of the readings
            var appXPath = [];
            var currentReading = 1;


            ////////////////////////////////////////////////////////////
            /* A function that redoes the layout and reloads the page */
            ////////////////////////////////////////////////////////////

            //////////////////////////
            /* navigation functions */
            //////////////////////////
            function applyZoom() {
                setOptions();
                vrvToolkit.redoLayout();

                page = 1;
                loadPage();
            }

            function nextPage()  {
                if (page >= vrvToolkit.getPageCount()) {
                    return;
                }

                page = page + 1;
                loadPage();
            };

            function prevPage() {
                if (page <= 1) {
                    return;
                }

                page = page - 1;
                loadPage();
            };

            function firstPage(){
                page = 1;
                loadPage();
            };

            function lastPage() {
                page = vrvToolkit.getPageCount();
                loadPage();
            };

            function zoomOut() {
                if (zoom < 20)  {
                    return;
                }
                zoom = zoom - 5;
                applyZoom();
            }

            function zoomIn() {
                if (zoom > 80) {
                    return;
                }
                zoom = zoom + 5;
                applyZoom();
            }

            ////////////////////
            /* MIDI FUNCTIONS */
            ////////////////////

            var ids = []; // this will store the IDs of highlighted notes
            var isPlaying = false;
            var isPaused = false;

            // i tried playing around with getting the player to sync to the previous timestamp when you switch readings, but was unsuccessful. you can play around with it if you want
            function reload_midi() { 
                // curTime = Math.floor($("#player").midiPlayer.getTime());
                $("#player").midiPlayer.stop();
                // play_midi();
                // $("#player").midiPlayer.seek(curTime-400);
            }

            function play_midi() {
                console.log("loading new midi file")
                var base64midi = vrvToolkit.renderToMIDI();
                var song = 'data:audio/midi;base64,' + base64midi;
                $("#player").show();
                $("#player").midiPlayer.play(song);
                isPlaying = true;
                isPaused = false;
            }

            function pause_midi() {
                console.log("pausing")
                document.getElementById('midiPlayer_pause').click();
                isPaused = true;
                isPlaying = true;
            }
        
            function unpause_midi() {
                console.log("unpausing")
                // curTime = Math.floor($("#player").midiPlayer.getTime());
                // console.log('time at unpause:', curTime);
                // $("#player").midiPlayer.seek(curTime-400);
                document.getElementById('midiPlayer_play').click();
                isPaused = false;
                isPlaying = true;
            }

            var midiUpdate = function(time) {
                var vrvTime = Math.max(0, time - 400);
                // get the notes at the current time
                var elementsattime = vrvToolkit.getElementsAtTime(vrvTime);
                if (elementsattime.page > 0) {
                    // move to the next page of music as necessary
                    if (elementsattime.page != page) {
                        page = elementsattime.page;
                        loadPage();
                    }
                    // if there are notes, and not all of them are in ids already
                    if ((elementsattime.notes.length > 0) && (ids != elementsattime.notes)) {
                        ids.forEach(function(noteid) {
                            // if we are not playing the note, set it to its color
                            if ($.inArray(noteid, elementsattime.notes) == -1) {
                                element = $("#" + noteid)[0]
                                if (element.closest(".rdg") != null){
                                    $("#" + noteid).attr("fill", "#d00").attr("stroke", "#d00");
                                } else if (element.closest(".lem") != null) {
                                    $("#" + noteid).attr("fill", "#00e").attr("stroke", "#00e");
                                } else {
                                    $("#" + noteid).attr("fill", "#000").attr("stroke", "#000");
                                }
                            }
                        });
                        ids = elementsattime.notes;
                        ids.forEach(function(noteid) {
                            // if we are playing the note, set it to red
                            if ($.inArray(noteid, elementsattime.notes) != -1) {
                                $("#" + noteid).attr("fill", "#ccc").attr("stroke", "#ccc");; 
                            }
                        }); 
                    }
                }
            }

            // when the midi stops playing, set all notes to black and hide the player
            var midiStop = function() {
                ids.forEach(function(noteid) {
                    $("#" + noteid).attr("fill", "#000").attr("stroke", "#000"); 
                });
                $(".lem").attr("fill", "#00e").attr("stroke", "#00e");
                $(".rdg").attr("fill", "#d00").attr("stroke", "#d00");
                
                // $("#player").hide();
                isPlaying = false;
                isPaused = false;
                console.log("midistop")
            }




            $(document).ready(function() 
            {

                ///////////////////////////////////
                /* Binding the navigation events */
                ///////////////////////////////////
                $(window).keyup(function(event){
                    // ctrl+leftarrow keypress
                    if (event.ctrlKey && (event.keyCode == 37)) 
                    {
                        firstPage();
                    }
                    // leftarrow keypress
                    else if (event.keyCode == 37) 
                    {
                        prevPage();
                    }
                    // ctrl + rightarrow keypress
                    else if (event.ctrlKey && (event.keyCode == 39)) 
                    {
                        lastPage();
                    }
                    // rightarrow keypress
                    else if (event.keyCode == 39) 
                    {
                        nextPage();
                    }
                    // + keypress
                    else if ((event.keyCode == 107) || (event.keyCode == 187) || (event.keyCode == 61) ) 
                    {
                        zoomIn();
                    }
                    // - keypress
                    else if ((event.keyCode == 109) || (event.keyCode == 189) || (event.keyCode == 173)) 
                    {
                        zoomOut();
                    }
                /////////////////////////////////
                /* binding the MIDI keypresses */
                /////////////////////////////////
                    else if (event.keyCode == 49) {
                        console.log("KEYPRESS: 1");
                        // load reading 1 in if it's not already
                        if (currentReading == 1){
                            return;
                        } else {
                            currentReading = 1;
                            appXPath = [];
                            loadFile();
                        }

                        // change the midi player if currently playing
                        if (isPlaying){
                            reload_midi()
                        }
                    }
                    else if (event.keyCode == 50) {
                        console.log("KEYPRESS: 2");
                        // load reading 2 in if it's not already
                        if (currentReading == 2){
                            return;
                        } else {
                            currentReading = 2;
                            appXPath = ["./rdg[contains(@source, '#Mahler')]"];
                            loadFile();
                        }

                        // change the midi player if currently playing
                        if (isPlaying){
                            reload_midi()
                        }
                    }

                    // toggle the MIDI when we press 'p'
                    else if (event.keyCode == 80) {
                        console.log("KEYPRESS: P");
                        // if paused, resume playing
                        if (isPaused){
                            unpause_midi();
                        } else {
                        // if it was playing the file but not paused, pause it
                            if (isPlaying){
                                pause_midi();
                        // otherwise begin playing
                            }else{
                                play_midi();
                            }
                        }
                    }
                });

                $(window).resize(function()
                {
                    applyZoom();
                });

                // add the player to the div
                $("#player").midiPlayer({
                    color: "#c00",
                    onUpdate: midiUpdate,
                    onStop: midiStop,
                    width: 250
                });

                loadFile();
                setTimeout(function(){
                    play_midi();
                    pause_midi();
                }, 500);       

            });

            ////////////////////////////////////////////
            /* Functions for loading page information */
            ////////////////////////////////////////////

            function setOptions() {
                pageHeight = $(document).height() * 95 / zoom ;
                pageWidth = $(window).width() * 95 / zoom ;
                options = {
                            pageHeight: pageHeight,
                            pageWidth: pageWidth,
                            scale: zoom,
                            adjustPageHeight: true,
                            appXPathQuery: appXPath
                        };
                vrvToolkit.setOptions(options);
            }

            function loadData(data) {
                setOptions();
                vrvToolkit.loadData(data);

                page = 1;
                loadPage();
            }

            function loadPage() {
                svg = vrvToolkit.renderToSVG(page, {});
                $("#svg_output").html(svg);

                // if we click a note, grab the ID and move the midi player to that time
                $(".note").click(function() {
                    var id = $(this).attr("id");
                    var time = vrvToolkit.getTimeForElement(id);
                    $("#midi-player").midiPlayer.seek(time);
                    isPaused = false
                });

                ///////////////////////////////////////////////////
                /* Highlights the lem in blue and the rdg in red */
                ///////////////////////////////////////////////////
                $(".lem").attr("fill", "#00e").attr("stroke", "#00e");
                $(".rdg").attr("fill", "#d00").attr("stroke", "#d00");
            };
 
            function loadFile() {
                file = "https://raw.githubusercontent.com/MrMeatScience/Mahler-as-Editor/master/MEI%20Examples/Act%202%2C%20Scene%202%20DB%20Fig%201%20test.mei";
                $.ajax({
                    url: file
                    , dataType: "text"
                    , success: function(data) {
                        loadData(data);
                    }
                });
            }
         </script>
     
     </body>
 </html> 
